.. -*- coding: utf-8 -*-

.. _buildout_crontab:

============================
Programar tareas con crontab
============================

.. sidebar:: Sobre este artículo

    :Autor(es): Leonardo J. Caballero G.
    :Correo(s): leonardoc@plone.org
    :Compatible con: Python 2.4 o versiones superiores
    :Fecha: 23 de Marzo de 2015

Descripción general
===================

Este es una configuración de :ref:`zc.buildout <python_buildout>` programar 
tareas con `crontab`_ locales al usuario efectivo del proyecto.


Instalación
===========

Puedes instalar zc.buildout usando `pip`_ (es recomendable 
hacerlo dentro de un `entorno virtual`_):

.. code-block:: sh

  $ pip install zc.buildout

Ahora crea una nueva configuración zc.buildout así:

.. code-block:: sh

  $ mkdir buildout.crontab ; $ cd buildout.crontab

Inicializar el proyecto 

.. code-block:: sh

  $ python bootstrap.py

Ahora el nuevo directorio :file:`buildout.crontab` es un proyecto zc.buildout.
El archivo de configuración predeterminado de buildout es :file:`buildout.cfg`. 
Después de la inicialización, tendrá el siguiente contenido:

.. code-block:: cfg

  [buildout]
  parts =

Puedes cambiarlo a:

.. code-block:: cfg

  [buildout]

  parts =
      restart-zope-daily
      
  # Este récipe ayuda a configurar una tarea de crontab de rotación de archivos log.
  # Para mayor información ver http://pypi.python.org/pypi/z3c.recipe.usercrontab
  [restart-zope-daily]
  recipe = z3c.recipe.usercrontab
  times = 0 3 * * 0-6
  command = ${buildout:bin-directory}/instance restart


Ahora ejecuta el comando :command:`buildout` disponible dentro del directorio
:file:`buildout.crontab/bin` con el argumento ``-v`` `(verbose mode)`, esto ayudará a que
muestre todo los detalles de la construcción del mismo:

.. code-block:: sh

  $ ./bin/buildout -vN


Ejecute el programa Bash script generado con el siguiente comando:

.. code-block:: sh

  $ crontab -l

  # Generated by /home/macagua/Plone/zinstance [restart-zope-daily]
  0 3 * * 0-6     /home/macagua/buildout.crontab/bin/instance restart
  # END /home/macagua/Plone/zinstance [restart-zope-daily]


Y de esta forma se ha generado la tarea del :command:`crontab` que reinicia 
la instancia de Zope diariamente a las `3 am`.


Descarga código fuente
======================

Para descargar el código fuente de este ejemplo ejecute el siguiente comando:

.. code-block:: sh

  $ git clone https://github.com/plone-ve/buildout.crontab.git


Artículos relacionados
======================

.. seealso:: Artículos sobre :ref:`replicación de proyectos Python <python_buildout>`.


Referencias
===========

-   `Buildout - How to maintain big app stacks without losing your mind`_.

.. _crontab: http://es.wikipedia.org/wiki/Cron_%28Unix%29
.. _Buildout - How to maintain big app stacks without losing your mind: http://www.slideshare.net/djay/buildout-how-to-maintain-big-app-stacks-without-losing-your-mind
.. _pip: http://plone-spanish-docs.readthedocs.org/es/latest/python/distribute_pip.html#que-es-pip
.. _entorno virtual: http://plone-spanish-docs.readthedocs.org/es/latest/python/creacion_entornos_virtuales.html#creacion-entornos-virtuales
