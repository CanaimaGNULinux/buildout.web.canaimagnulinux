.. -*- coding: utf-8 -*-

.. highlight:: rest

.. _mantenimiento_website:

=============
Mantenimiento
=============

En está sección se describe las diversas tareas de mantenimiento del sistema sobre 
este sistema en entornos de producción.

.. _reboot_supervisord:

Arranque de servicios
=====================

Cada ves que se reinicie el servidor se ha programado una tarea para que inicie
todos los servicios necesarios para que Plone este funcionado correctamente.

.. code-block:: console

    $ crontab -l
    
    # Generated by /home/plone/sitioweb [supervisor-crontab]
    @reboot	/home/plone/sitioweb/bin/supervisord
    # END /home/plone/sitioweb [supervisor-crontab]

.. _rotar_archivos_log:

Rotar archivos de registros
===========================

Se define tareas de rotación de archivos configurar tarea programadas 
`rotación de archivos registros`_ del sistema (archivos .log) con el 
programa `crontab`_ del sistema operativo, para realizar esta tarea, 
la cual se realizara semanalmente.

.. code-block:: console

    $ crontab -l
    
    # Generated by /home/plone/sitioweb [logrotate-crontab]
    @daily	/usr/sbin/logrotate -s /home/plone/sitioweb/var/logrotate.status \ 
                /home/plone/sitioweb/etc/logrotate.conf
    # END /home/plone/sitioweb [logrotate-crontab]

.. _zeopack_task:

Compactación de la base de datos
================================

Debido a la naturaleza de la base de datos :ref:`ZODB <que_es_zodb>` 
de Plone con el mecanismo de `FileStorage <http://docs.zope.org/zope2/zdgbook/ZODBPersistentComponents.html>`_ 
esta guarda todas las modificaciones a las contenidos o configuraciones 
realizadas desde Plone y :ref:`Zope <que_es_zope>`, 
incluso las configuraciones de que módulos adicionales tiene habilitados 
en cada entorno de trabajo.

Por eso es necesario estar haciendo adicionalmente labores de mantenimiento de la 
base de datos, a través de compactar frecuentemente la :ref:`ZODB <que_es_zodb>` 
de esta mantera se evita el crecimiento desproporcionado de la :ref:`ZODB <que_es_zodb>`.

El procedimiento consiste en borrar revisiones viejas de un registro o contenido cargado.
Cada vez que se escribe en la :ref:`ZODB <que_es_zodb>`, se crea una revisión del estado de uno 
o varios registros o contenidos cargados. Esta labor le permite elegir cuantos días de 
historial quieres dejar.

El tiempo promedio para realizar esta labor es de acuerdo a la modificación con que 
los usuarios realizan modificaciones de contenidos. Lo recomendado es hacer un monitoreo 
del comportamiento de los usuarios en el sistema usando Munin para evaluar con que 
frecuencia modifican los contenidos y de allí sacar una media para la organización.

La recomendación: se realice **semanalmente (cada semana)**.

Actualmente esta tarea esta deshabilitada en espera de decidir cual es el tiempo promedio 
de históricos a preservar en la herramienta, esto parametrizable del administrador del servidor 
de la Plone

.. code-block:: console

    $ crontab -l
    
    # Generated by /home/plone/sitioweb [maintenance-schedule-crontab]
    0 3 * * 7	/home/plone/sitioweb/bin/zeopack
    # END /home/plone/sitioweb [maintenance-schedule-crontab]

.. _backup_zodb:

Respaldo de base de datos
=========================

Se define varias tareas de respaldo de la base de datos las cuales se describen a continuación:

- **Respaldo incremental:**  esta tarea hace un respaldo incremental, la cual se realizara 
  **diariamente a las 2 AM**.

- **Respaldo completo:** esta tarea hace una copia de seguridad completa, la cual se realizara 
  semanalmente **cada domingo a las 2 AM**.

- **Respaldo captura actual:** esta tarea hace una copia de seguridad completa, separada de las 
  copias de seguridad periódicas. Útil para copiar la base de datos de producción actual de su 
  ordenador portátil o justo antes de un gran cambio en el sitio, la cual se realizara semanalmente 
  **cada domingo a las 2 AM**.

.. code-block:: console

    $ crontab -l
    
    # Generated by /home/plone/sitioweb [backup-daily-crontab]
    0 2 * * 0-6	/home/plone/sitioweb/bin/backup
    # END /home/plone/sitioweb [backup-daily-crontab]
    
    # Generated by /home/plone/sitioweb [backup-weekly-crontab]
    0 2 * * 7	/home/plone/sitioweb/bin/snapshotbackup
    # END /home/plone/sitioweb [backup-weekly-crontab]
    
    # Generated by /home/plone/sitioweb [backup-full-weekly-crontab]
    0 2 * * 7	/home/plone/sitioweb/bin/fullbackup
    # END /home/plone/sitioweb [backup-full-weekly-crontab]

.. _rotación de archivos registros: http://manpages.ubuntu.com/manpages/hardy/es/man8/logrotate.8.html
.. _crontab: http://es.wikipedia.org/wiki/Cron_(Unix)
